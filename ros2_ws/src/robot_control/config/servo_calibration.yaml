# ============================================================================
# SERVO CALIBRATION CONFIGURATION
# Production-Ready Configuration for ML-Based Object Picking Robot
# ============================================================================
# 
# This file contains servo motor calibration parameters for the robot
# manipulator arm. All values are carefully tuned for industrial operation.
#
# CRITICAL: Do NOT modify these values without proper testing and validation
# on a test bench. Incorrect values can cause:
# - Mechanical damage to the robot
# - Servo burnout
# - Unsafe robot movements
# - Collision with workspace objects
#
# Author: Victor's Production Team
# Last Updated: 2025-01-12
# Robot Model: 6-DOF Manipulator Arm with Gripper
# ============================================================================

# General servo configuration
servo_config:
  # PWM frequency for servo control (Hz)
  # Standard servo PWM frequency: 50Hz (20ms period)
  pwm_frequency: 50
  
  # Update rate for servo commands (Hz)
  # Lower = smoother but slower, Higher = faster but jerkier
  # Recommended: 20-50 Hz for industrial robots
  update_rate: 30
  
  # PWM resolution (bits)
  # Raspberry Pi supports 12-bit resolution (0-4095)
  pwm_resolution: 12
  
  # Safety parameters
  safety:
    # Maximum velocity (degrees/second)
    max_velocity: 60.0
    
    # Maximum acceleration (degrees/second²)
    max_acceleration: 120.0
    
    # Emergency stop deceleration (degrees/second²)
    emergency_deceleration: 300.0
    
    # Enable software limit checking
    enable_limits: true
    
    # Enable collision detection
    enable_collision_detection: true
    
    # Watchdog timeout (seconds) - stops servos if no command received
    watchdog_timeout: 2.0

# ============================================================================
# JOINT CONFIGURATIONS
# ============================================================================
# Each joint (servo) has the following parameters:
# - id: Servo ID/channel on the controller
# - name: Human-readable joint name
# - type: Servo type (standard, continuous, digital)
# - min_angle: Minimum safe angle (degrees)
# - max_angle: Maximum safe angle (degrees)
# - home_angle: Home/rest position (degrees)
# - min_pulse_width: PWM pulse width at min angle (microseconds)
# - max_pulse_width: PWM pulse width at max angle (microseconds)
# - offset: Calibration offset (degrees)
# - direction: Rotation direction (1 = normal, -1 = reversed)
# - max_torque: Maximum allowed torque (%)
# ============================================================================

joints:
  # ---------------------------------------------------------------------------
  # Joint 0: Base Rotation (Azimuth)
  # ---------------------------------------------------------------------------
  base_rotation:
    id: 0
    name: "Base Rotation"
    type: "digital"
    description: "Rotates the entire arm horizontally"
    
    # Angle limits (degrees)
    min_angle: -170.0
    max_angle: 170.0
    home_angle: 0.0
    
    # PWM pulse width range (microseconds)
    # Standard: 500-2500µs for 0-180°
    min_pulse_width: 500
    max_pulse_width: 2500
    
    # Calibration offset (fine-tune alignment)
    offset: 2.3
    
    # Direction: 1 = clockwise positive, -1 = counter-clockwise positive
    direction: 1
    
    # Maximum torque limit (0-100%)
    max_torque: 85
    
    # Velocity limits (degrees/second)
    max_velocity: 45.0
    
    # Physical properties
    gear_ratio: 1.0
    mass: 0.5  # kg (for dynamics calculations)
    
  # ---------------------------------------------------------------------------
  # Joint 1: Shoulder (Pitch)
  # ---------------------------------------------------------------------------
  shoulder:
    id: 1
    name: "Shoulder"
    type: "digital"
    description: "Moves the arm up and down (sagittal plane)"
    
    min_angle: -90.0
    max_angle: 90.0
    home_angle: 0.0
    
    min_pulse_width: 500
    max_pulse_width: 2500
    
    offset: -1.5
    direction: -1  # Reversed for mechanical design
    max_torque: 90
    max_velocity: 40.0
    
    gear_ratio: 2.0
    mass: 0.4
    
  # ---------------------------------------------------------------------------
  # Joint 2: Elbow (Pitch)
  # ---------------------------------------------------------------------------
  elbow:
    id: 2
    name: "Elbow"
    type: "digital"
    description: "Bends the forearm relative to upper arm"
    
    min_angle: -135.0
    max_angle: 135.0
    home_angle: 0.0
    
    min_pulse_width: 500
    max_pulse_width: 2500
    
    offset: 0.8
    direction: 1
    max_torque: 85
    max_velocity: 50.0
    
    gear_ratio: 1.5
    mass: 0.3
    
  # ---------------------------------------------------------------------------
  # Joint 3: Wrist Roll
  # ---------------------------------------------------------------------------
  wrist_roll:
    id: 3
    name: "Wrist Roll"
    type: "digital"
    description: "Rotates the wrist around the forearm axis"
    
    min_angle: -180.0
    max_angle: 180.0
    home_angle: 0.0
    
    min_pulse_width: 500
    max_pulse_width: 2500
    
    offset: -0.5
    direction: 1
    max_torque: 70
    max_velocity: 60.0
    
    gear_ratio: 1.0
    mass: 0.15
    
  # ---------------------------------------------------------------------------
  # Joint 4: Wrist Pitch
  # ---------------------------------------------------------------------------
  wrist_pitch:
    id: 4
    name: "Wrist Pitch"
    type: "digital"
    description: "Tilts the gripper up and down"
    
    min_angle: -90.0
    max_angle: 90.0
    home_angle: 0.0
    
    min_pulse_width: 500
    max_pulse_width: 2500
    
    offset: 1.2
    direction: -1
    max_torque: 70
    max_velocity: 55.0
    
    gear_ratio: 1.0
    mass: 0.12
    
  # ---------------------------------------------------------------------------
  # Joint 5: Wrist Yaw (Optional for 6-DOF)
  # ---------------------------------------------------------------------------
  wrist_yaw:
    id: 5
    name: "Wrist Yaw"
    type: "digital"
    description: "Rotates the gripper left and right"
    
    min_angle: -90.0
    max_angle: 90.0
    home_angle: 0.0
    
    min_pulse_width: 500
    max_pulse_width: 2500
    
    offset: 0.0
    direction: 1
    max_torque: 65
    max_velocity: 60.0
    
    gear_ratio: 1.0
    mass: 0.1
    
  # ---------------------------------------------------------------------------
  # Gripper
  # ---------------------------------------------------------------------------
  gripper:
    id: 6
    name: "Gripper"
    type: "digital"
    description: "Opens and closes the end effector"
    
    # Gripper positions
    min_angle: 0.0     # Fully open
    max_angle: 90.0    # Fully closed
    home_angle: 0.0    # Open by default
    
    min_pulse_width: 1000  # Open position
    max_pulse_width: 2000  # Closed position
    
    offset: 0.0
    direction: 1
    max_torque: 80  # Higher torque for gripping
    max_velocity: 70.0
    
    # Gripper-specific parameters
    grasp_force: 60  # Percentage of max torque for holding
    release_angle: 10.0  # Slightly open for release
    
    gear_ratio: 1.0
    mass: 0.08

# ============================================================================
# PREDEFINED POSITIONS
# ============================================================================
# Named poses for common robot configurations
# All angles in degrees
# ============================================================================

named_positions:
  # Home position - safe starting position
  home:
    base_rotation: 0.0
    shoulder: 0.0
    elbow: 0.0
    wrist_roll: 0.0
    wrist_pitch: 0.0
    wrist_yaw: 0.0
    gripper: 0.0
    
  # Rest position - compact storage position
  rest:
    base_rotation: 0.0
    shoulder: -45.0
    elbow: 90.0
    wrist_roll: 0.0
    wrist_pitch: -45.0
    wrist_yaw: 0.0
    gripper: 0.0
    
  # Pick ready - ready to pick objects from above
  pick_ready:
    base_rotation: 0.0
    shoulder: 30.0
    elbow: -60.0
    wrist_roll: 0.0
    wrist_pitch: 30.0
    wrist_yaw: 0.0
    gripper: 0.0
    
  # Place ready - ready to place objects
  place_ready:
    base_rotation: 90.0
    shoulder: 20.0
    elbow: -40.0
    wrist_roll: 0.0
    wrist_pitch: 20.0
    wrist_yaw: 0.0
    gripper: 90.0
    
  # Observation - camera viewing position
  observation:
    base_rotation: 0.0
    shoulder: 60.0
    elbow: -90.0
    wrist_roll: 0.0
    wrist_pitch: 30.0
    wrist_yaw: 0.0
    gripper: 0.0
    
  # Emergency stop - safe position for emergency
  emergency_stop:
    base_rotation: 0.0
    shoulder: 0.0
    elbow: 0.0
    wrist_roll: 0.0
    wrist_pitch: 0.0
    wrist_yaw: 0.0
    gripper: 0.0

# ============================================================================
# TRAJECTORY PARAMETERS
# ============================================================================
# Motion planning and trajectory generation settings
# ============================================================================

trajectory:
  # Interpolation method: 'linear', 'cubic', 'quintic'
  interpolation_method: "cubic"
  
  # Time step for trajectory generation (seconds)
  time_step: 0.02
  
  # Velocity scaling factor (0.0 - 1.0)
  # Lower = slower but safer, Higher = faster but riskier
  velocity_scale: 0.7
  
  # Acceleration scaling factor (0.0 - 1.0)
  acceleration_scale: 0.5
  
  # Smoothing window size (number of points)
  smoothing_window: 5
  
  # Enable trajectory validation before execution
  validate_trajectory: true

# ============================================================================
# COMMUNICATION SETTINGS
# ============================================================================
# Servo controller communication parameters
# ============================================================================

communication:
  # Communication protocol: 'pwm', 'i2c', 'uart', 'spi'
  protocol: "pwm"
  
  # For I2C/UART protocols
  device: "/dev/i2c-1"
  address: 0x40  # PCA9685 default address
  
  # Baud rate for UART
  baud_rate: 115200
  
  # Timeout for communication (seconds)
  timeout: 0.5
  
  # Retry attempts for failed commands
  max_retries: 3
  
  # Delay between retries (seconds)
  retry_delay: 0.1

# ============================================================================
# MONITORING AND LOGGING
# ============================================================================

monitoring:
  # Enable position feedback monitoring
  enable_feedback: true
  
  # Enable current/torque monitoring (if supported)
  enable_current_monitoring: false
  
  # Enable temperature monitoring
  enable_temperature_monitoring: false
  
  # Logging level: 'DEBUG', 'INFO', 'WARNING', 'ERROR'
  log_level: "INFO"
  
  # Log servo positions to file
  log_positions: true
  log_file: "/var/log/robot/servo_positions.log"
  
  # Performance metrics collection
  collect_metrics: true
  metrics_update_rate: 1.0  # Hz

# ============================================================================
# CALIBRATION METADATA
# ============================================================================

calibration_metadata:
  calibration_date: "2025-01-12"
  calibrated_by: "Victor's Production Team"
  calibration_method: "Manual with dial indicator"
  robot_serial_number: "MLR-001"
  firmware_version: "1.0.0"
  notes: |
    Initial production calibration.
    All joints tested at full range of motion.
    Safety limits verified with mechanical stops.
    Gripper force calibrated with 500g test weight.
  
  # Next calibration due date
  next_calibration_due: "2025-07-12"
  
  # Calibration tolerance (degrees)
  position_tolerance: 0.5
  
  # Verified by quality control
  quality_control_approved: true
  qc_inspector: "QC-Team-A"

# ============================================================================
# HARDWARE-SPECIFIC SETTINGS
# ============================================================================

hardware:
  # Servo controller board
  controller_board: "PCA9685"
  controller_channels: 16
  
  # Raspberry Pi GPIO pins (if using direct PWM)
  gpio_pins:
    base_rotation: 12
    shoulder: 13
    elbow: 18
    wrist_roll: 19
    wrist_pitch: 16
    wrist_yaw: 20
    gripper: 21
  
  # Power supply specifications
  power_supply:
    voltage: 6.0  # Volts
    max_current: 10.0  # Amperes
    enable_overcurrent_protection: true
    current_limit: 8.0  # Amperes
  
  # Servo specifications (if all servos are identical)
  servo_model: "MG996R"
  servo_specs:
    stall_torque: 11.0  # kg-cm at 6V
    operating_voltage: [4.8, 7.2]  # Volts
    speed: 0.17  # sec/60° at 6V
    weight: 55.0  # grams
